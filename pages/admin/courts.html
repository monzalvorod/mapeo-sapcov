<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gestión de Juzgados - SAPCOV</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="../../css/styles.css">
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="container mx-auto py-6 px-4">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8">
      <div>
        <h1 class="text-2xl font-bold text-gray-800">Gestión de Juzgados</h1>
        <p class="text-gray-600" id="adminInfo">Usuario Administrador</p>
      </div>
      
      <div class="mt-4 md:mt-0 flex space-x-3">
        <button class="px-4 py-2 bg-white text-gray-600 rounded-lg shadow-sm border border-gray-300 hover:bg-gray-50 flex items-center">
          <i class="fas fa-download mr-2"></i>
          Exportar Lista
        </button>
        <button class="px-4 py-2 bg-blue-600 text-white rounded-lg shadow-sm hover:bg-blue-700 flex items-center">
          <i class="fas fa-plus mr-2"></i>
          Agregar Juzgado
        </button>
      </div>
    </div>
    
    <!-- Court Management Interface -->
    <div class="bg-white rounded-card shadow-sm p-6">
      <!-- Search and Filter Controls -->
      <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
        <div class="relative w-full md:w-96 mb-4 md:mb-0">
          <input type="text" id="courtSearch" placeholder="Buscar juzgados..." class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
          <i class="fas fa-search absolute left-3 top-3 text-gray-400"></i>
        </div>
        
        <div class="flex flex-col sm:flex-row space-y-2 sm:space-y-0 sm:space-x-3 w-full md:w-auto">
          <select id="statusFilter" class="bg-gray-50 border border-gray-300 text-gray-700 py-2 px-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
            <option value="">Todos los Estados</option>
            <option value="Completed">Completado</option>
            <option value="Advanced">Avanzado</option>
            <option value="In Progress">En Progreso</option>
            <option value="Initial Stage">Etapa Inicial</option>
            <option value="Not Started">No Iniciado</option>
          </select>
          
          <select id="regionFilter" class="bg-gray-50 border border-gray-300 text-gray-700 py-2 px-3 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm">
            <option value="">Todas las Regiones</option>
            <option value="North">Norte</option>
            <option value="Central">Centro</option>
            <option value="South">Sur</option>
            <option value="East">Este</option>
            <option value="West">Oeste</option>
          </select>
        </div>
      </div>
      
      <!-- Courts Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead>
            <tr>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Juzgado
              </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Administrador
              </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Progreso
              </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Estado
              </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Región
              </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Última Actualización
              </th>
              <th class="px-6 py-3 bg-gray-50 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                Acciones
              </th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200" id="courtsTableBody">
            <!-- Table rows will be populated dynamically -->
          </tbody>
        </table>
      </div>
      
      <!-- Pagination -->
      <div class="mt-6 flex justify-between items-center">
        <div class="text-sm text-gray-500">
          Showing <span id="showingCount" class="font-medium">1-10</span> of <span id="totalCount" class="font-medium">32</span> courts
        </div>
        <div class="flex space-x-2">
          <button class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 hover:bg-gray-50">
            Previous
          </button>
          <button class="px-3 py-1 bg-blue-600 text-white rounded-md text-sm hover:bg-blue-700">
            1
          </button>
          <button class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 hover:bg-gray-50">
            2
          </button>
          <button class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 hover:bg-gray-50">
            3
          </button>
          <button class="px-3 py-1 border border-gray-300 rounded-md text-sm text-gray-600 hover:bg-gray-50">
            Next
          </button>
        </div>
      </div>
    </div>
    
    <!-- Actions Modal (Hidden by default) -->
    <div id="actionsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg max-w-md w-full p-6 relative">
        <button id="closeModal" class="absolute top-3 right-3 text-gray-500 hover:text-gray-700">
          <i class="fas fa-times"></i>
        </button>
        
        <h3 class="text-xl font-bold text-gray-800 mb-4" id="modalCourtTitle">Acciones del Juzgado</h3>
        
        <div class="space-y-3">
          <button class="w-full px-4 py-2 bg-blue-100 text-blue-700 rounded-lg hover:bg-blue-200 transition flex items-center">
            <i class="fas fa-eye mr-3 w-5 text-center"></i>
            <span>Ver Detalles del Juzgado</span>
          </button>
          
          <button class="w-full px-4 py-2 bg-green-100 text-green-700 rounded-lg hover:bg-green-200 transition flex items-center">
            <i class="fas fa-edit mr-3 w-5 text-center"></i>
            <span>Editar Información del Juzgado</span>
          </button>
          
          <button class="w-full px-4 py-2 bg-yellow-100 text-yellow-700 rounded-lg hover:bg-yellow-200 transition flex items-center">
            <i class="fas fa-user-plus mr-3 w-5 text-center"></i>
            <span>Gestionar Equipo del Juzgado</span>
          </button>
          
          <button class="w-full px-4 py-2 bg-purple-100 text-purple-700 rounded-lg hover:bg-purple-200 transition flex items-center">
            <i class="fas fa-file mr-3 w-5 text-center"></i>
            <span>Ver Archivos del Juzgado</span>
          </button>
          
          <button class="w-full px-4 py-2 bg-indigo-100 text-indigo-700 rounded-lg hover:bg-indigo-200 transition flex items-center">
            <i class="fas fa-chart-line mr-3 w-5 text-center"></i>
            <span>Reporte de Progreso del Juzgado</span>
          </button>
          
          <button class="w-full px-4 py-2 bg-red-100 text-red-700 rounded-lg hover:bg-red-200 transition flex items-center">
            <i class="fas fa-trash-alt mr-3 w-5 text-center"></i>
            <span>Desactivar Juzgado</span>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // Get parent window's app API
      const appAPI = window.parent.appAPI;
      const user = appAPI.getUserData();
      const workflowSteps = appAPI.getWorkflowSteps();
      const stateProgress = appAPI.getStateProgress();
      
      // Set admin info
      document.getElementById('adminInfo').textContent = `${user.role === 'unicef_admin' ? 'UNICEF' : 'ODI'} Administrador`;
      
      // Populate courts table
      const courtsTableBody = document.getElementById('courtsTableBody');
      const mockAdministrators = [
        "Judge Maria Lopez", "Judge Carlos Ramirez", "Judge Ana Gonzalez", 
        "Judge Roberto Sanchez", "Judge Elena Rodriguez", "Judge Javier Mendez",
        "Judge Sofia Hernandez", "Judge Luis Torres", "Judge Diana Martinez",
        "Judge Miguel Flores"
      ];
      
      const regions = ["North", "Central", "South", "East", "West"];
      
      // Sort states by name
      const sortedStates = [...stateProgress].sort((a, b) => a.state.localeCompare(b.state));
      
      sortedStates.forEach((state, index) => {
        const currentStep = workflowSteps[state.currentStep - 1];
        const row = document.createElement('tr');
        
        // Determine status class and text based on progress
        let statusClass = '';
        let statusText = '';
        
        if (state.overall >= 95) {
          statusClass = 'bg-green-100 text-green-800';
          statusText = 'Completado';
        } else if (state.overall >= 50) {
          statusClass = 'bg-blue-100 text-blue-800';
          statusText = 'Avanzado';
        } else if (state.overall >= 25) {
          statusClass = 'bg-yellow-100 text-yellow-800';
          statusText = 'En Progreso';
        } else if (state.overall >= 5) {
          statusClass = 'bg-gray-100 text-gray-800';
          statusText = 'Etapa Inicial';
        } else {
          statusClass = 'bg-red-100 text-red-800';
          statusText = 'No Iniciado';
        }
        
        // Assign a random region (for demo purposes)
        const region = regions[Math.floor(Math.random() * regions.length)];
        
        // Assign a random administrator (for demo purposes)
        const administrator = mockAdministrators[index % mockAdministrators.length];
        
        // Generate random last update date (for demo purposes)
        const lastUpdate = new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toLocaleDateString();
        
        row.dataset.courtName = state.state;
        row.dataset.status = statusText;
        row.dataset.region = region;
        
        row.innerHTML = `
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="flex-shrink-0 h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center">
                <i class="fas fa-gavel text-blue-600"></i>
              </div>
              <div class="ml-4">
                <div class="text-sm font-medium text-gray-900">Juzgado del Estado de ${state.state}</div>
                <div class="text-xs text-gray-500">ID: MEX-${state.state.substring(0, 3).toUpperCase()}-${String(index + 1).padStart(3, '0')}</div>
              </div>
            </div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-gray-900">${administrator}</div>
            <div class="text-xs text-gray-500">${administrator.split(' ')[1].toLowerCase()}@${state.state.toLowerCase().replace(' ', '')}.courts.mx</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <div class="flex items-center">
              <div class="w-32 h-2 bg-gray-200 rounded-full mr-2">
                <div class="h-2 bg-blue-600 rounded-full" style="width: ${state.overall}%"></div>
              </div>
              <span class="text-sm font-medium">${state.overall}%</span>
            </div>
            <div class="text-xs text-gray-500 mt-1">Paso ${state.currentStep} de 8: ${currentStep.title}</div>
          </td>
          <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${statusClass}">
              ${statusText}
            </span>
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
            ${region}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            ${lastUpdate}
          </td>
          <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
            <div class="flex space-x-2">
              <button class="text-blue-600 hover:text-blue-800" title="Ver">
                <i class="fas fa-eye"></i>
              </button>
              <button class="text-green-600 hover:text-green-800" title="Editar">
                <i class="fas fa-edit"></i>
              </button>
              <button class="court-actions text-gray-500 hover:text-gray-700" title="Más Acciones" data-court="${state.state}">
                <i class="fas fa-ellipsis-v"></i>
              </button>
            </div>
          </td>
        `;
        
        courtsTableBody.appendChild(row);
      });
      
      // Update count display
      document.getElementById('totalCount').textContent = sortedStates.length;
      document.getElementById('showingCount').textContent = `1-${Math.min(10, sortedStates.length)}`;
      
      // Search and filter functionality
      const courtSearch = document.getElementById('courtSearch');
      const statusFilter = document.getElementById('statusFilter');
      const regionFilter = document.getElementById('regionFilter');
      
      function applyFilters() {
        const searchTerm = courtSearch.value.toLowerCase();
        const statusTerm = statusFilter.value;
        const regionTerm = regionFilter.value;
        
        let visibleCount = 0;
        
        document.querySelectorAll('#courtsTableBody tr').forEach(row => {
          const courtName = row.dataset.courtName.toLowerCase();
          const status = row.dataset.status;
          const region = row.dataset.region;
          
          const matchesSearch = courtName.includes(searchTerm);
          const matchesStatus = statusTerm === '' || status === statusTerm;
          const matchesRegion = regionTerm === '' || region === regionTerm;
          
          if (matchesSearch && matchesStatus && matchesRegion) {
            row.classList.remove('hidden');
            visibleCount++;
          } else {
            row.classList.add('hidden');
          }
        });
        
        // Update count display
        document.getElementById('showingCount').textContent = visibleCount === 0 ? '0' : `1-${Math.min(10, visibleCount)}`;
      }
      
      courtSearch.addEventListener('input', applyFilters);
      statusFilter.addEventListener('change', applyFilters);
      regionFilter.addEventListener('change', applyFilters);
      
      // Actions modal functionality
      const actionsModal = document.getElementById('actionsModal');
      const modalCourtTitle = document.getElementById('modalCourtTitle');
      const closeModal = document.getElementById('closeModal');
      
      // Add event listeners to action buttons
      document.querySelectorAll('.court-actions').forEach(btn => {
        btn.addEventListener('click', () => {
          const courtName = btn.dataset.court;
          modalCourtTitle.textContent = `Acciones del Juzgado del Estado de ${courtName}`;
          actionsModal.classList.remove('hidden');
        });
      });
      
      // Close modal
      closeModal.addEventListener('click', () => {
        actionsModal.classList.add('hidden');
      });
      
      // Close modal when clicking outside
      actionsModal.addEventListener('click', (e) => {
        if (e.target === actionsModal) {
          actionsModal.classList.add('hidden');
        }
      });
    });
  </script>
</body>
</html> 